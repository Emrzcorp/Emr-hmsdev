<div class="container">
  <div class="row g-3">
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm" style="height: 350px;">
        <div class="card-body">
          <h5 class="card-title mb-3"><i class="bi bi-person-badge me-2"></i>Patient</h5>
          <div class="fw-bold fs-5"><%= @patient.full_name %></div>
          <div class="text-muted"><%= @patient.gender %> • DOB: <%= @patient.date_of_birth %> • Age: <%= @patient.age %></div>
          <hr>
          <div class="mb-2"><i class="bi bi-telephone me-2"></i><%= @patient.phone_number %></div>
          <div class="mb-2"><i class="bi bi-envelope me-2"></i><%= @patient.email_address %></div>
          <div class="mb-2"><i class="bi bi-geo-alt me-2"></i><%= [@patient.address_1, @patient.address_2, @patient.city].compact_blank.join(", ") %></div>
          <div class="mb-2"><i class="bi bi-person-vcard me-2"></i>Doctor: <%= @patient.doctor&.full_name || "Not assigned" %></div>
          <div class="mt-3">
            <%= link_to raw('<i class="bi bi-pencil"></i> Edit'), edit_patient_path(@patient), class: "btn btn-sm btn-outline-primary" %>
            <%= link_to raw('<i class="bi bi-arrow-left-circle"></i> Back'), patients_path, class: "btn btn-sm btn-outline-primary" %>
          </div>
        </div>
      </div>

      <div class="card shadow-sm mt-3" style="height: 250px;">
        <div class="card-body">
          <h6 class="card-title mb-3"><i class="bi bi-folder2-open me-2"></i>Documents</h6>
          <% if @patient.documents.attached? %>
            <div class="d-flex flex-wrap gap-2">
              <% @patient.documents.each do |doc| %>
                <%= link_to image_tag(doc.representation(resize_to_limit: [96,96])), rails_blob_path(doc, disposition: "attachment"), class: "border rounded" %>
              <% end %>
            </div>
          <% else %>
            <div class="text-muted">No documents.</div>
          <% end %>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-8">
      <div class="card shadow-sm" style="height: 350px;">
        <div class="card-body">
          <ul class="nav nav-tabs bg-white" id="patientTabs" role="tablist">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#overview">Overview</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#timeline">Timeline</button></li>
          </ul>
          <div class="tab-content pt-3">
            <div class="tab-pane fade show active" id="overview">
              <p><strong>Status:</strong> <%= @patient.status.presence || "-" %></p>
              <p><strong>Allergies:</strong> <%= @patient.allergies.presence || "-" %></p>
              <p><strong>Current medications:</strong> <%= @patient.current_medications.presence || "-" %></p>
              <p><strong>Medical history:</strong> <%= simple_format(@patient.medical_history) %></p>
            </div>
            <div class="tab-pane fade" id="timeline">
              <!-- Later: render encounters, notes, orders grouped by date -->
              <div class="text-muted fw-bold">Coming soon: encounters, vitals, orders, messages…</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
